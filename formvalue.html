<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Data</title>
    <style>
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .styled-table {
  border-collapse: collapse;
  margin: 25px 0;
  font-size: 18px;
  font-family: Arial, sans-serif;
  width: 100%;
  border: 1px solid #ddd;
}
.savebutton {
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .savebutton:hover {
            background-color: #218838;
        }
.styled-table thead tr {
  background-color: #009879;
  color: #ffffff;
  text-align: left;
}

.styled-table th,
.styled-table td {
  padding: 12px 15px;
  text-align: center;
}

.styled-table tbody tr {
  border-bottom: 1px solid #dddddd;
}

.styled-table tbody tr:nth-of-type(even) {
  background-color: #f3f3f3;
}

.styled-table tbody tr:last-of-type {
  border-bottom: 2px solid #009879;
}

.styled-table tbody tr:hover {
  background-color: #f1f1f1;
  cursor: pointer;
}

    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        
        
        <div id="dataOutput">
            <div class="text-center mb-4">
              
                <h1>Saz Cars Ebiz Auctions LLC</h1>
                <h3>104-83 Khalid Shaban Building, Al Garhoud, Dubai UAE</h3>
                <h3>Contact: +971506360426 | +971588897653 Email: info@sazcars.com</h3>
                <h1 >Car Inspection Report</h1>
            </div>
            <table class="styled-table">
                <tr><td><h4>1</h4></td>
                    <Td><H4>Make: </H4></Td><Td><H4 id="Make"></H4></Td>              
                </tr>
                <tr><td><h4>2</h4></td><Td><H4>Model:</H4></Td><Td><H4 id="Model"></H4></Td></tr>
                <tr><td><h4>3</h4></td><Td><H4>Variant:</H4></Td><Td><H4 id="Variant"></H4></Td></tr>
                <tr><td><h4>4</h4></td><Td><H4>Transmission:</H4></Td><Td><H4 id="Transmission"></H4></Td></tr>
                <tr><td><h4>5</h4></td><Td><H4>Year:</H4></Td><Td><H4 id="Year"></H4></Td></tr>
                <!-- <tr><Td><H4>Specs: </H4></Td><Td><H4 id="Specs"></H4></Td></tr> -->
                <tr><td><h4>6</h4></td><Td><H4>Car Number:</H4></Td><Td><H4 id="carNumber"></H4></Td></tr>
                <tr><td><h4>7</h4></td><Td><H4>Odometer Reading: </H4></Td><Td><H4 id="odometerReading"></H4></Td></tr>
                <tr><td><h4>8</h4></td><Td><H4>Hazard Lights Working:</H4></Td><Td><H4 id="Hazard"></H4></Td></tr>
                <tr><td><h4>9</h4></td><Td><H4>Head Lights Working:</H4></Td><Td><H4 id="headLights"></H4></Td></tr>
                <tr><td><h4>10</h4></td><Td><H4>Brake Lights Working:</H4></Td><Td><H4 id="brakeLights"></H4></Td></tr>
                <tr><td><h4>11</h4></td><Td><H4>Parking Lights Working:</H4></Td><Td><H4 id="parkingLights"></H4></Td></tr>
                <tr><td><h4>12</h4></td><Td><H4>Reverse Lights Working:</H4></Td><Td><H4 id="reverseLights"></H4></Td></tr>
                <tr><td><h4>13</h4></td><Td><H4>Number Plate Lights Working:</H4></Td><Td><H4 id="numberPlate"></H4></Td></tr>
                <tr><td><h4>14</h4></td><Td><H4>Seat Belts:</H4></Td><Td><H4 id="seatBelts"></H4></Td></tr>
                <tr><td><h4>15</h4></td><Td><H4>Tyres Condition:</H4></Td><Td><H4 id="tyresCondition"></H4></Td></tr>
                <tr><td><h4>16</h4></td><Td><H4>Oil Leakage:</H4></Td><Td><H4 id="oilLeakage"></H4></Td></tr>
                <tr><td><h4>17</h4></td><Td><H4>Bushes all - Lower Arm, Upper Arm, Control Arm, Stabilizer:</H4></Td><Td><H4 id="allBushes"></H4></Td></tr>
                <tr><td><h4>18</h4></td><Td><H4>Boots all - Axle, Link rod:</H4></Td><Td><H4 id="allBoots"></H4></Td></tr>
                <tr><td><h4>19</h4></td><Td><H4>Brakes:</H4></Td><Td><H4 id="Brakes"></H4></Td></tr>
                <tr><td><h4>20</h4></td><Td><H4>Battery:</H4></Td><Td><H4 id="Battery"></H4></Td></tr>
                <tr><td><h4>21</h4></td><Td><H4>Chassis:</H4></Td><Td><H4 id="Chassis"></H4></Td></tr>
                <tr><td><h4>22</h4></td><Td><H4>Odometer:</H4></Td><Td><H4 id="Odometer"></H4></Td></tr>
                <tr><td><h4>23</h4></td><Td><H4>Rust at Boot, Chassis:</H4></Td><Td><H4 id="Rust"></H4></Td></tr>
                <tr><td><h4>24</h4></td><Td><H4>Engine Oil Levels:</H4></Td><Td><H4 id="engineOils"></H4></Td></tr>
                <tr><td><h4>25</h4></td><Td><H4>Coolant Levels:</H4></Td><Td><H4 id="Coolant"></H4></Td></tr>
                <tr><td><h4>26</h4></td><Td><H4>Brake Oil Levels:</H4></Td><Td><H4 id="brakeOil"></H4></Td></tr>
                <tr><td><h4>27</h4></td><Td><H4>Steering Oil Levels:</H4></Td><Td><H4 id="steeringOil"></H4></Td></tr>
                <tr><td><h4>28</h4></td><Td><H4>Engine Overheating:</H4></Td><Td><H4 id="engineOverheating"></H4></Td></tr>
            </table>
        </div>
        <div class="container">
            <button class="savebutton" onclick="savePageAsPDF()" style="float: right;">Save as PDF</button>

        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        const formData = JSON.parse(localStorage.getItem('formData')) || {};

        document.addEventListener('DOMContentLoaded', () => {

            const formData = JSON.parse(localStorage.getItem('formData')) || {};
            const dataOutput = document.getElementById('dataOutput');
            const carMake = document.getElementById('Make');
            carMake.textContent = formData.Make;
            const carModel = document.getElementById('Model');
            carModel.textContent = formData.Model;
            const carVariant = document.getElementById('Variant');
            carVariant.textContent = formData.Variant;
            const carTransmission = document.getElementById('Transmission');
            carTransmission.textContent = formData.Transmission;
            const carYear = document.getElementById('Year');
            carYear.textContent = formData.Year;
            const number = document.getElementById('carNumber');
            number.textContent = formData.carNumber;
            const oReading = document.getElementById('odometerReading');
            oReading.textContent = formData.odometerReading;
         
            const hazardLights = document.getElementById('Hazard');
            hazardLights.textContent = formData.Hazard;
            updateLightStatus('Hazard', formData.Hazard);
            const headLight = document.getElementById('headLights');
            headLight.textContent = formData.headLights;
            updateLightStatus('headLights', formData.headLights);
            const bLight = document.getElementById('brakeLights');
            bLight.textContent = formData.brakeLights;
            updateLightStatus('brakeLights', formData.brakeLights);
            const pLight = document.getElementById('parkingLights');
            pLight.textContent = formData.parkingLights;
            updateLightStatus('parkingLights', formData.parkingLights);
            const rLight = document.getElementById('reverseLights');
            rLight.textContent = formData.reverseLights;
            updateLightStatus('reverseLights', formData.reverseLights);
            const npLight = document.getElementById('numberPlate');
            npLight.textContent = formData.numberPlate;
            updateLightStatus('numberPlate', formData.numberPlate);
            const belts = document.getElementById('seatBelts');
            belts.textContent = formData.seatBelts;
            updateLightStatus('seatBelts', formData.seatBelts);
            const tyres = document.getElementById('tyresCondition');
            tyres.textContent = formData.tyresCondition;
            updateLightStatus('tyresCondition', formData.tyresCondition);
            const oil = document.getElementById('oilLeakage');
            oil.textContent = formData.oilLeakage;
            updateLightStatus('oilLeakage', formData.oilLeakage);
            const bushes = document.getElementById('allBushes');
            bushes.textContent = formData.allBushes;
            updateLightStatus('allBushes', formData.allBushes);
            const boots = document.getElementById('allBoots');
            boots.textContent = formData.allBoots;
            updateLightStatus('allBoots', formData.allBoots);
            const brake = document.getElementById('Brakes');
            brake.textContent = formData.Brakes;
            updateLightStatus('Brakes', formData.Brakes);
            const battery = document.getElementById('Battery');
            battery.textContent = formData.Battery;
            updateLightStatus('Battery', formData.Battery);
            const chassis = document.getElementById('Chassis');
            chassis.textContent = formData.Chassis;
            updateLightStatus('Chassis', formData.Chassis);
            const odometer = document.getElementById('Odometer');
            odometer.textContent = formData.Odometer;
            updateLightStatus('Odometer', formData.Odometer);
            const rust = document.getElementById('Rust');
            Rust.textContent = formData.Rust;
            updateLightStatus('Rust', formData.Rust);
            const eOils = document.getElementById('engineOils');
            eOils.textContent = formData.engineOils;
            updateLightStatus('engineOils', formData.engineOils);
            const coolant = document.getElementById('Coolant');
            coolant.textContent = formData.Coolant;
            updateLightStatus('Coolant', formData.Coolant);
            const bOil = document.getElementById('brakeOil');
            bOil.textContent = formData.brakeOil;
            updateLightStatus('brakeOil', formData.brakeOil);
            const sOil = document.getElementById('steeringOil');
            sOil.textContent = formData.steeringOil;
            updateLightStatus('steeringOil', formData.steeringOil);
            const overheating= document.getElementById('engineOverheating');
            overheating.textContent = formData.engineOverheating;
           if(formData.engineOverheating ==="Yes"){
            overheating.style.color = "Red"
           }
           else
           {
            overheating.style.color = "Green"
           }
    
    function updateLightStatus(elementId, value) {
    const element = document.getElementById(elementId);
    element.textContent = value;
    element.style.color = {
    "Yes": "Green",
    "Okay": "Green",
    "Actual":"Green",
    "Reversed":"Red",
    "Rusted":"Red",
    "Non Rusted":"Green",
    "Low":"Red",
    "No": "Red",
    "Not Okay": "Red",
    "Good": "Green",
    "Not Good": "Orange",
    "Expired": "Red",
    "Minor": "Yellow",
    "Major": "Red",
    "Dripping":"Orange",
    "No Leaks": "Green",
    "Worn Out": "Red",
    "Leaking": "Orange",
    "Not Working": "Red",
    "Dead": "Red",
    "Weak": "Yellow",
    "Jump Start": "Orange",
    "Bend": "Red",
    "Repaired": "Yellow"
}[value] || "Black"; // Default to "Black" if value doesn't match

}
                  
            

        });

    async function savePageAsPDF() {
    const { jsPDF } = window.jspdf;
    const dataContainer = document.getElementById('dataOutput');

    // Ensure images are fully loaded before generating PDF
    const loadImages = async () => {
        const images = dataContainer.querySelectorAll('img');
        return Promise.all(Array.from(images).map(img => {
            return new Promise((resolve, reject) => {
                if (img.complete) {
                    resolve();
                } else {
                    img.onload = resolve;
                    img.onerror = reject;
                }
            });
        }));
    };

    await loadImages(); // Ensure all images are loaded

    const options = {
        scale: 3, // High-quality rendering
        useCORS: true, 
        allowTaint: true, 
        logging: false,
        scrollX: 0,
        scrollY: 0,
        windowWidth: dataContainer.scrollWidth, // Capture full width
        windowHeight: dataContainer.scrollHeight, // Capture full height
    };

    try {
        const canvas = await html2canvas(dataContainer, options);
        const imgData = canvas.toDataURL('image/png');

        // Set PDF format based on screen size
        let pdfFormat = window.innerWidth < 768 ? 'a5' : 'a4'; 
        let pdf = new jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: pdfFormat,
        });

        let pdfWidth = pdf.internal.pageSize.getWidth();
        let pdfHeight = pdf.internal.pageSize.getHeight();
        let imgWidth = pdfWidth;
        let imgHeight = (canvas.height * pdfWidth) / canvas.width;

        const marginTop = 10;
        const marginBottom = 15;
        let yPosition = marginTop;
        let currentCanvasY = 0; // Track how much of the image has been processed

        // Split content properly across multiple pages
        while (currentCanvasY < canvas.height) {
            let renderHeight = Math.min(canvas.height - currentCanvasY, (pdfHeight - marginTop - marginBottom) * (canvas.width / pdfWidth));
            
            let croppedCanvas = document.createElement("canvas");
            croppedCanvas.width = canvas.width;
            croppedCanvas.height = renderHeight;

            let ctx = croppedCanvas.getContext("2d");
            ctx.drawImage(canvas, 0, currentCanvasY, canvas.width, renderHeight, 0, 0, canvas.width, renderHeight);

            let croppedImgData = croppedCanvas.toDataURL("image/png");

            pdf.addImage(croppedImgData, "PNG", 0, marginTop, imgWidth, (renderHeight / canvas.width) * pdfWidth);
            
            currentCanvasY += renderHeight;

            if (currentCanvasY < canvas.height) {
                pdf.addPage();
            }
        }

        // Generate dynamic file name
        const fileName = `${formData?.Make || 'Form'}_${formData?.carNumber || 'Data'}.pdf`;
        pdf.save(fileName);

    } catch (error) {
        console.error('Error generating PDF:', error);
    }
}




    

        // async function savePageAsPDF() {
        //     const { jsPDF } = window.jspdf;
        //     const dataContainer = document.getElementById('dataOutput');

        //     html2canvas(dataContainer, { scale: 3, useCORS: true }).then((canvas) => {
        //         const imgData = canvas.toDataURL('image/png');
        //         const pdf = new jsPDF({
        //             orientation: 'portrait',
        //             unit: 'mm',
        //             format: 'a4',
        //         });

        //         const pdfWidth = pdf.internal.pageSize.getWidth();
        //         const pdfHeight = pdf.internal.pageSize.getHeight();

        //         pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);

        //         const fileName = `${formData.Make || 'Form'}_${formData.Car_Number || 'Data'}.pdf`;
        //         pdf.save(fileName);
        //     }).catch((error) => {
        //         console.error('Error generating PDF:', error);
        //     });
        // }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
